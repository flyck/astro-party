---
import { ToastError } from "../components/toast.astro";
import { ZodSchema } from "zod";

export function getPartyIdOrThrowToast(request: Request) {
  const url = new URL(request.headers.get("Hx-Current-Url") || "");
  const id = url.pathname.split("/")[1] || "";

  if (!id) {
    throw new ToastError("danger", "Bad request", 400);
  }
  return id;
}

export async function validateFormOrThrowToast(
  request: Request,
  schema: ZodSchema,
) {
  const data = await request.formData();
  let inputJson: { [key: string]: any } = {};
  data.forEach((value, key: string) => {
    inputJson[key] = value;
  });

  const parsedInput = schema.safeParse(inputJson);

  console.info("Input correct: " + parsedInput.success);

  if (!parsedInput.success) {
    throw new ToastError("warning", "Bad inputs", 400);
  }

  return parsedInput.data;
}
---
